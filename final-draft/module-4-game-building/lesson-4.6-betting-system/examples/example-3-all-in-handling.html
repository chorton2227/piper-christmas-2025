<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example 3: All-In Handling - Betting System</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
            background-color: #2c5530;
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        h1 { color: #2c5530; margin-top: 0; }
        .pot-display {
            font-size: 24px;
            font-weight: bold;
            color: #2c5530;
            text-align: center;
            padding: 15px;
            background: #ffd700;
            border-radius: 10px;
            margin: 20px 0;
        }
        .players-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .player-card {
            border: 3px solid #ddd;
            border-radius: 10px;
            padding: 15px;
            background: white;
            transition: all 0.3s;
        }
        .player-card.all-in {
            border-color: #e91e63;
            background: #fce4ec;
            position: relative;
        }
        .player-card.all-in::before {
            content: 'üî• ALL-IN';
            position: absolute;
            top: 10px;
            right: 10px;
            background: #e91e63;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .player-name {
            font-size: 18px;
            font-weight: bold;
            color: #2c5530;
            margin-bottom: 10px;
        }
        .player-stats {
            font-size: 14px;
            margin: 5px 0;
        }
        .scenario-controls {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        .btn-all-in { background: #e91e63; }
        .btn-all-in:hover { background: #c2185b; }
        .output {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
        }
        .debug {
            font-family: monospace;
            background: #1e1e1e;
            color: #4ec9b0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Example 3: All-In Handling</h1>
        <p>This example demonstrates <strong>all-in</strong> situations when players run out of chips.</p>
        <p><strong>Key Concept:</strong> Players can bet all their remaining chips, even if it's less than the current bet!</p>
        
        <div class="pot-display">
            Pot: $<span id="pot">0</span> | Current Bet: $<span id="currentBet">0</span>
        </div>

        <div id="playersDisplay" class="players-grid"></div>

        <div class="scenario-controls">
            <h3>All-In Scenarios</h3>
            <button onclick="setupScenario1()">Scenario 1: Short Stack Call</button>
            <button onclick="setupScenario2()">Scenario 2: All-In Raise</button>
            <button onclick="setupScenario3()">Scenario 3: Multiple All-Ins</button>
        </div>

        <button onclick="testCase1()">Test Case 1: Can't Match Bet</button>
        <button onclick="testCase2()">Test Case 2: All-In as Raise</button>
        <button onclick="testCase3()">Test Case 3: All-In Players Stay</button>
        
        <div id="output" class="output">
            <h3>Scenario details will appear here...</h3>
        </div>
        
        <div id="debug" class="debug"></div>
    </div>

    <script>
        // Game state
        let gameState = {
            players: [],
            currentBet: 0,
            pot: 0
        };

        // All-in function
        function allIn(state, playerId) {
            const player = state.players.find(p => p.id === playerId);
            
            if (!player) {
                return { success: false, error: 'Player not found' };
            }
            
            if (player.chips === 0) {
                return { success: false, error: 'Player has no chips' };
            }
            
            if (player.allIn) {
                return { success: false, error: 'Player already all-in' };
            }
            
            const allInAmount = player.chips;
            player.chips = 0;
            player.bet += allInAmount;
            state.pot += allInAmount;
            player.allIn = true;
            
            // Update current bet if this all-in is higher
            if (player.bet > state.currentBet) {
                console.log(`All-in of $${player.bet} raises the bet from $${state.currentBet}`);
                state.currentBet = player.bet;
            } else {
                console.log(`All-in of $${player.bet} (less than current bet of $${state.currentBet})`);
            }
            
            console.log(`${player.name} goes all-in for $${allInAmount}!`);
            
            return { 
                success: true, 
                action: 'all-in',
                amount: allInAmount,
                totalBet: player.bet,
                message: `${player.name} goes all-in for $${allInAmount}!`
            };
        }

        // Call function (may trigger all-in)
        function call(state, playerId) {
            const player = state.players.find(p => p.id === playerId);
            
            if (!player) {
                return { success: false, error: 'Player not found' };
            }
            
            const amountToCall = state.currentBet - player.bet;
            
            if (amountToCall === 0) {
                return { success: false, error: 'Nothing to call' };
            }
            
            // If player doesn't have enough, go all-in instead
            if (amountToCall > player.chips) {
                console.log(`${player.name} doesn't have enough to call, going all-in instead`);
                return allIn(state, playerId);
            }
            
            player.chips -= amountToCall;
            player.bet += amountToCall;
            state.pot += amountToCall;
            
            console.log(`${player.name} calls $${amountToCall}`);
            
            return { 
                success: true, 
                action: 'call',
                amount: amountToCall,
                message: `${player.name} calls $${amountToCall}`
            };
        }

        // UI Functions
        function updateDisplay() {
            document.getElementById('pot').textContent = gameState.pot;
            document.getElementById('currentBet').textContent = gameState.currentBet;
            
            const playersDiv = document.getElementById('playersDisplay');
            playersDiv.innerHTML = '';
            
            gameState.players.forEach(player => {
                const card = document.createElement('div');
                card.className = 'player-card' + (player.allIn ? ' all-in' : '');
                card.innerHTML = `
                    <div class="player-name">${player.name}</div>
                    <div class="player-stats">üí∞ Chips: $${player.chips}</div>
                    <div class="player-stats">üéØ Bet: $${player.bet}</div>
                    ${player.allIn ? '<div class="player-stats" style="color: #e91e63; font-weight: bold;">‚ö†Ô∏è ALL-IN - Cannot bet more</div>' : ''}
                `;
                playersDiv.appendChild(card);
            });
        }

        function logOutput(message, isError = false) {
            const output = document.getElementById('output');
            const color = isError ? '#d32f2f' : '#2c5530';
            output.innerHTML = `<h3 style="color: ${color}">${message}</h3>`;
        }

        // Scenarios
        function setupScenario1() {
            console.log('\n=== Scenario 1: Short Stack Must Go All-In to Call ===');
            gameState = {
                players: [
                    { id: 0, name: 'Alice', chips: 500, bet: 500, allIn: false },
                    { id: 1, name: 'Bob (Short Stack)', chips: 300, bet: 0, allIn: false }
                ],
                currentBet: 500,
                pot: 500
            };
            
            updateDisplay();
            logOutput('Scenario 1: Bob has only $300 but needs to call $500. He must go all-in!');
            console.log('Bob has $300, current bet is $500');
            console.log('Bob will go all-in if he tries to call');
        }

        function setupScenario2() {
            console.log('\n=== Scenario 2: All-In Can Be a Raise ===');
            gameState = {
                players: [
                    { id: 0, name: 'Charlie', chips: 0, bet: 200, allIn: true },
                    { id: 1, name: 'Diana', chips: 500, bet: 200, allIn: false }
                ],
                currentBet: 200,
                pot: 400
            };
            
            updateDisplay();
            logOutput('Scenario 2: Charlie went all-in for $200, raising the bet. Diana must call or fold!');
            console.log('Charlie raised to $200 by going all-in');
        }

        function setupScenario3() {
            console.log('\n=== Scenario 3: Multiple Players All-In ===');
            gameState = {
                players: [
                    { id: 0, name: 'Player 1', chips: 0, bet: 100, allIn: true },
                    { id: 1, name: 'Player 2', chips: 0, bet: 300, allIn: true },
                    { id: 2, name: 'Player 3', chips: 200, bet: 300, allIn: false }
                ],
                currentBet: 300,
                pot: 700
            };
            
            updateDisplay();
            logOutput('Scenario 3: Two players all-in at different amounts. Creates side pots!');
            console.log('Player 1 all-in for $100');
            console.log('Player 2 all-in for $300');
            console.log('Player 3 still has chips');
        }

        // Test Cases
        function testCase1() {
            console.log('\n=== Test Case 1: Insufficient Chips Forces All-In ===');
            gameState = {
                players: [
                    { id: 0, name: 'Alice', chips: 0, bet: 500, allIn: false },
                    { id: 1, name: 'Bob', chips: 300, bet: 0, allIn: false }
                ],
                currentBet: 500,
                pot: 500
            };
            
            // Bob tries to call but can only go all-in
            const result = call(gameState, 1);
            
            updateDisplay();
            if (result.success && result.action === 'all-in') {
                logOutput(`‚úÖ Test Case 1: Bob went all-in for $${result.amount}! (Couldn't afford full call of $500)`);
                console.log('Result: Forced all-in - ' + result.message);
            }
        }

        function testCase2() {
            console.log('\n=== Test Case 2: All-In Raises the Bet ===');
            gameState = {
                players: [
                    { id: 0, name: 'Charlie', chips: 800, bet: 0, allIn: false },
                    { id: 1, name: 'Diana', chips: 0, bet: 0, allIn: false }
                ],
                currentBet: 0,
                pot: 0
            };
            
            // Diana goes all-in for $800 as opening bet
            const result = allIn(gameState, 0);
            
            updateDisplay();
            if (result.success) {
                logOutput(`‚úÖ Test Case 2: All-in of $${result.amount} sets current bet to $${gameState.currentBet}!`);
                console.log('Result: All-in raised bet to $' + gameState.currentBet);
            }
        }

        function testCase3() {
            console.log('\n=== Test Case 3: All-In Players Cannot Bet Again ===');
            gameState = {
                players: [
                    { id: 0, name: 'Eve', chips: 0, bet: 500, allIn: true },
                    { id: 1, name: 'Frank', chips: 1000, bet: 500, allIn: false }
                ],
                currentBet: 500,
                pot: 1000
            };
            
            // Try to make Eve bet again (should fail)
            const result = allIn(gameState, 0);
            
            updateDisplay();
            if (!result.success) {
                logOutput(`‚úÖ Test Case 3: Correctly prevented all-in player from betting! Error: ${result.error}`);
                console.log('Result: All-in player cannot bet - ' + result.error);
            }
        }

        // Capture console output to debug div
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const debugDiv = document.getElementById('debug');
            debugDiv.textContent += args.join(' ') + '\n';
        };

        // Initialize
        console.log('=== Example 3: All-In Handling ===');
        console.log('Demonstrating all-in situations and rules');
        setupScenario1();
    </script>
</body>
</html>
