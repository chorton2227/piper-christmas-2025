<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Dealer Intelligence - Test Page</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        
        .difficulty-selector {
            margin: 30px 0;
            text-align: center;
        }
        
        .difficulty-selector h2 {
            margin-bottom: 15px;
            color: #FFD700;
        }
        
        .difficulty-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .difficulty-btn {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .difficulty-btn.easy {
            background: linear-gradient(135deg, #7CFC00, #32CD32);
            color: #000;
        }
        
        .difficulty-btn.medium {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            color: #000;
        }
        
        .difficulty-btn.hard {
            background: linear-gradient(135deg, #FF6347, #DC143C);
            color: #fff;
        }
        
        .difficulty-btn.expert {
            background: linear-gradient(135deg, #8B0000, #4B0000);
            color: #fff;
            border: 2px solid #FFD700;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }
        
        .difficulty-btn.active {
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
        }
        
        .game-area {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 20px;
            margin: 30px 0;
        }
        
        .info-panel {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid rgba(255, 215, 0, 0.2);
        }
        
        .info-panel h3 {
            color: #FFD700;
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .stat {
            margin: 10px 0;
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .stat-label {
            font-weight: 500;
            color: #aaa;
        }
        
        .stat-value {
            font-weight: bold;
            color: #FFD700;
            font-size: 1.1em;
        }
        
        .poker-table {
            background: radial-gradient(ellipse at center, #1e5631 0%, #0e3b1f 100%);
            border: 15px solid #8B4513;
            border-radius: 200px;
            padding: 40px;
            box-shadow: 
                inset 0 0 50px rgba(0, 0, 0, 0.5),
                0 10px 50px rgba(0, 0, 0, 0.8);
            min-height: 500px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .dealer-area, .player-area {
            text-align: center;
        }
        
        .cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 15px 0;
            flex-wrap: wrap;
        }
        
        .card {
            width: 70px;
            height: 100px;
            background: white;
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.5);
            position: relative;
        }
        
        .card.hearts, .card.diamonds {
            color: #DC143C;
        }
        
        .card.clubs, .card.spades {
            color: #000;
        }
        
        .card.back {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #FFD700;
            font-size: 2em;
        }
        
        .card-rank {
            font-size: 1.3em;
        }
        
        .card-suit {
            font-size: 1.8em;
            line-height: 0.8;
        }
        
        .community-cards {
            margin: 30px 0;
        }
        
        .community-cards h3 {
            margin-bottom: 15px;
            color: #FFD700;
        }
        
        .pot-info {
            text-align: center;
            margin: 20px 0;
        }
        
        .pot-amount {
            font-size: 2em;
            font-weight: bold;
            color: #FFD700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .action-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 12px 25px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }
        
        .action-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 215, 0, 0.5);
        }
        
        .action-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .action-btn.fold { background: #DC143C; color: white; }
        .action-btn.check { background: #4169E1; color: white; }
        .action-btn.call { background: #32CD32; color: white; }
        .action-btn.bet { background: #FFA500; color: black; }
        .action-btn.raise { background: #FFD700; color: black; }
        .action-btn.allin { background: #8B0000; color: white; border: 2px solid #FFD700; }
        
        .log-panel {
            background: rgba(0, 0, 0, 0.5);
            padding: 20px;
            border-radius: 15px;
            max-height: 600px;
            overflow-y: auto;
        }
        
        .log-panel h3 {
            color: #FFD700;
            margin-bottom: 15px;
            position: sticky;
            top: 0;
            background: rgba(0, 0, 0, 0.9);
            padding: 10px;
            margin: -20px -20px 15px -20px;
        }
        
        .log-entry {
            margin: 8px 0;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            border-left: 3px solid #FFD700;
            font-size: 0.9em;
        }
        
        .log-entry.info { border-left-color: #4169E1; }
        .log-entry.success { border-left-color: #32CD32; }
        .log-entry.warning { border-left-color: #FFA500; }
        .log-entry.error { border-left-color: #DC143C; }
        
        .ai-analysis {
            margin-top: 20px;
            padding: 15px;
            background: rgba(255, 215, 0, 0.1);
            border-radius: 10px;
            border: 2px solid rgba(255, 215, 0, 0.3);
        }
        
        .ai-analysis h4 {
            color: #FFD700;
            margin-bottom: 10px;
        }
        
        .progress-bar {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            overflow: hidden;
            height: 20px;
            margin: 5px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #FFD700, #FFA500);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8em;
            font-weight: bold;
            color: #000;
        }
        
        @media (max-width: 1200px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        .highlight {
            outline: 3px solid #FFD700;
            box-shadow: 0 0 18px rgba(255,215,0,.6);
            border-radius: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ü§ñ AI Dealer Intelligence</h1>
            <p>Test your intelligent poker AI opponent</p>
            <label style="display:inline-flex;align-items:center;gap:8px;margin-top:8px;">
                <input type="checkbox" id="guided-toggle" /> Guided Mode
            </label>
        </header>
        
        <div class="difficulty-selector">
            <h2>Select Difficulty</h2>
            <div class="difficulty-buttons">
                <button class="difficulty-btn easy" onclick="changeDifficulty('easy')">
                    üòä Easy<br><small>Passive & Predictable</small>
                </button>
                <button class="difficulty-btn medium active" onclick="changeDifficulty('medium')">
                    üòê Medium<br><small>Balanced Play</small>
                </button>
                <button class="difficulty-btn hard" onclick="changeDifficulty('hard')">
                    üò§ Hard<br><small>Aggressive & Smart</small>
                </button>
                <button class="difficulty-btn expert" onclick="changeDifficulty('expert')">
                    üòà Expert<br><small>Master Level</small>
                </button>
            </div>
        </div>
        
        <div class="game-area">
            <!-- Left Panel: Player Stats -->
            <div class="info-panel">
                <h3>üìä Player Statistics</h3>
                <div class="stat">
                    <span class="stat-label">Hands Played:</span>
                    <span class="stat-value" id="hands-played">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Bets:</span>
                    <span class="stat-value" id="total-bets">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Raises:</span>
                    <span class="stat-value" id="total-raises">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Calls:</span>
                    <span class="stat-value" id="total-calls">0</span>
                </div>
                <div class="stat">
                    <span class="stat-label">Total Folds:</span>
                    <span class="stat-value" id="total-folds">0</span>
                </div>
                
                <div class="ai-analysis" id="ai-analysis">
                    <h4>ü§ñ AI Analysis</h4>
                    <p><strong>Player Type:</strong> <span id="player-type">Unknown</span></p>
                    <p><strong>Confidence:</strong></p>
                    <div class="progress-bar">
                        <div class="progress-fill" id="confidence-bar" style="width: 0%">0%</div>
                    </div>
                    <p style="margin-top: 10px; font-size: 0.9em; color: #aaa;">
                        <em id="ai-strategy">Play a few hands for AI to learn your style...</em>
                    </p>
                </div>
            </div>
            
            <!-- Center: Poker Table -->
            <div class="poker-table">
                <div class="dealer-area">
                    <h3>üé© Dealer</h3>
                    <div class="stat" style="display: inline-block; margin: 10px auto;">
                        <span class="stat-label">Chips:</span>
                        <span class="stat-value" id="dealer-chips">1000</span>
                    </div>
                    <div class="cards" id="dealer-cards">
                        <div class="card back">üÇ†</div>
                        <div class="card back">üÇ†</div>
                    </div>
                </div>
                
                <div class="community-cards">
                    <h3 id="phase-label">Pre-Flop</h3>
                    <div class="cards" id="community-cards"></div>
                </div>
                
                <div class="pot-info">
                    <div>Pot</div>
                    <div class="pot-amount" id="pot-amount">$0</div>
                </div>
                
                <div class="player-area">
                    <div class="cards" id="player-cards"></div>
                    <div class="stat" style="display: inline-block; margin: 10px auto;">
                        <span class="stat-label">Chips:</span>
                        <span class="stat-value" id="player-chips">1000</span>
                    </div>
                    <h3>üë§ You</h3>
                </div>
                
                <div class="action-buttons">
                    <button class="action-btn fold" id="btnFold" onclick="playerAction('fold')">Fold</button>
                    <button class="action-btn check" id="btnCheck" onclick="playerAction('check')">Check</button>
                    <button class="action-btn call" id="btnCall" onclick="playerAction('call')">Call</button>
                    <button class="action-btn bet" id="btnBet" onclick="playerAction('bet')">Bet</button>
                    <button class="action-btn raise" id="btnRaise" onclick="playerAction('raise')">Raise</button>
                    <button class="action-btn allin" id="btnAllIn" onclick="playerAction('allin')">All In</button>
                </div>
                <div id="guidedPrompt" style="background:rgba(255,215,0,0.12);border-left:4px solid #FFD700;color:#fff;padding:.6rem .9rem;border-radius:10px;min-height:2.2rem;font-size:.95rem;"></div>
            </div>
            
            <!-- Right Panel: Game Log -->
            <div class="info-panel">
                <div class="log-panel">
                    <h3>üìã Game Log</h3>
                    <div id="game-log"></div>
                </div>
                
                <button style="margin-top: 20px; width: 100%; padding: 15px; font-size: 1.1em; background: linear-gradient(135deg, #FFD700, #FFA500); border: none; border-radius: 10px; font-weight: bold; cursor: pointer;" onclick="startNewGame()">
                    üéÆ New Game
                </button>
            </div>
        </div>
    </div>
    
    <!-- Removed external script dependency; rewritten self-contained game logic below -->
    <script>
        /********************
         * CORE GAME STATE  *
         ********************/
        const gameState = {
            playerChips: 1000,
            dealerChips: 1000,
            pot: 0,
            currentBet: 0,
            playerBet: 0,
            dealerBet: 0,
            playerHoleCards: [],
            dealerHoleCards: [],
            communityCards: [],
            deck: [],
            gamePhase: 'waiting', // waiting | pre-flop | flop | turn | river | showdown
            handNumber: 0,
            foldedPlayer: null,
            playerAllIn: false,
            dealerAllIn: false,
            playerStats: {
                handsPlayed: 0,
                totalBets: 0,
                totalRaises: 0,
                totalCalls: 0,
                totalFolds: 0
            },
            playerModel: {
                type: 'unknown', // aggressive-loose | aggressive-tight | passive-loose | passive-tight | balanced | unknown
                confidence: 0
            },
            difficulty: 'medium',
            guidedMode: false
        };

        /********************
         * UTILITY FUNCTIONS *
         ********************/
        function createDeck() {
            const suits = ['hearts','diamonds','clubs','spades'];
            const deck = [];
            for (let suit of suits) {
                for (let rank = 2; rank <= 14; rank++) {
                    deck.push({ rank, suit });
                }
            }
            // Fisher-Yates shuffle
            for (let i = deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [deck[i], deck[j]] = [deck[j], deck[i]];
            }
            return deck;
        }

        function dealCard() { return gameState.deck.pop(); }

        function rankToString(rank) {
            if (rank <= 10) return rank === 10 ? '10' : String(rank);
            return {11:'J',12:'Q',13:'K',14:'A'}[rank];
        }
        function getSuitSymbol(suit) {
            return { hearts: '‚ô•', diamonds: '‚ô¶', clubs: '‚ô£', spades: '‚ô†' }[suit];
        }

        function setDifficulty(level) {
            gameState.difficulty = level;
        }

        /********************
         * HAND EVALUATION  * (simplified placeholder ‚Äì ranks by highest card only)
         ********************/
        function evaluateHand(cards) {
            // Simple evaluation: rank = highest card value; highCard same
            let high = 0;
            for (const c of cards) if (c.rank > high) high = c.rank;
            return { rank: high, highCard: high, description: 'High Card' };
        }

        /********************
         * PLAYER MODEL UPDATE (stub)
         ********************/
        function updatePlayerModel() {
            const s = gameState.playerStats;
            if (s.handsPlayed < 5) { gameState.playerModel.type = 'unknown'; gameState.playerModel.confidence = s.handsPlayed / 5; return; }
            const aggression = (s.totalBets + s.totalRaises) / Math.max(1, s.handsPlayed);
            const looseness = (s.totalCalls + s.totalBets + s.totalRaises) / Math.max(1, s.handsPlayed);
            let type = 'balanced';
            if (aggression > 2 && looseness > 2) type = 'aggressive-loose';
            else if (aggression > 2) type = 'aggressive-tight';
            else if (looseness > 2) type = 'passive-loose';
            else if (aggression < 1 && looseness < 1) type = 'passive-tight';
            gameState.playerModel.type = type;
            gameState.playerModel.confidence = Math.min(1, s.handsPlayed / 25);
        }

        /********************
         * TRACKING PLAYER ACTIONS
         ********************/
        function trackPlayerAction(action) {
            if (action === 'bet') gameState.playerStats.totalBets++;
            if (action === 'raise') gameState.playerStats.totalRaises++;
            if (action === 'call') gameState.playerStats.totalCalls++;
            if (action === 'fold') gameState.playerStats.totalFolds++;
        }

        /********************
         * PLAYER ACTIONS
         ********************/
        function playerFold() {
            trackPlayerAction('fold');
            gameState.foldedPlayer = 'player';
            gameState.gamePhase = 'showdown';
            addLog('You fold', 'warning');
        }
        function playerCheck() { addLog('You check', 'info'); }
        function playerCall() {
            const toCall = gameState.currentBet - gameState.playerBet;
            const amount = Math.min(toCall, gameState.playerChips);
            gameState.playerChips -= amount;
            gameState.playerBet += amount;
            gameState.pot += amount;
            trackPlayerAction('call');
            addLog(`You call ${amount}`, 'info');
            if (gameState.playerChips === 0) { gameState.playerAllIn = true; addLog('You are ALL-IN!', 'success'); }
        }
        function playerBet(amount) {
            amount = Math.min(amount, gameState.playerChips);
            gameState.playerChips -= amount;
            gameState.playerBet += amount;
            gameState.currentBet = gameState.playerBet;
            gameState.pot += amount;
            trackPlayerAction('bet');
            addLog(`You bet ${amount}`, 'success');
            if (gameState.playerChips === 0) { gameState.playerAllIn = true; addLog('You are ALL-IN!', 'success'); }
        }
        function playerRaise(amount) {
            const toCall = gameState.currentBet - gameState.playerBet;
            amount = Math.min(amount, gameState.playerChips - toCall);
            // First call, then raise extra
            gameState.playerChips -= (toCall + amount);
            gameState.playerBet = gameState.currentBet + amount;
            gameState.currentBet = gameState.playerBet;
            gameState.pot += (toCall + amount);
            trackPlayerAction('raise');
            addLog(`You raise ${toCall + amount} (includes call)`, 'success');
            if (gameState.playerChips === 0) { gameState.playerAllIn = true; addLog('You are ALL-IN!', 'success'); }
        }
        function playerAllIn() {
            const amount = gameState.playerChips;
            gameState.playerChips = 0;
            const toAdd = amount;
            gameState.playerBet += toAdd;
            if (gameState.playerBet > gameState.currentBet) gameState.currentBet = gameState.playerBet;
            gameState.pot += toAdd;
            trackPlayerAction('bet');
        }

        /********************
         * DEALER ACTIONS & AI (simplified)
         ********************/
        function dealerFold() { gameState.foldedPlayer = 'dealer'; gameState.gamePhase = 'showdown'; addLog('Dealer folds', 'warning'); }
        function dealerCheck() { addLog('Dealer checks', 'info'); }
        function dealerCall() {
            const toCall = gameState.currentBet - gameState.dealerBet;
            const amount = Math.min(toCall, gameState.dealerChips);
            gameState.dealerChips -= amount;
            gameState.dealerBet += amount;
            gameState.pot += amount;
            addLog(`Dealer calls ${amount}`, 'info');
            if (gameState.dealerChips === 0) { gameState.dealerAllIn = true; addLog('Dealer is ALL-IN!', 'warning'); }
        }
        function dealerBet(amount) {
            amount = Math.min(amount, gameState.dealerChips);
            gameState.dealerChips -= amount;
            gameState.dealerBet += amount;
            gameState.currentBet = gameState.dealerBet;
            gameState.pot += amount;
            addLog(`Dealer bets ${amount}`, 'info');
            if (gameState.dealerChips === 0) { gameState.dealerAllIn = true; addLog('Dealer is ALL-IN!', 'warning'); }
        }
        function dealerRaise(amount) {
            const toCall = gameState.currentBet - gameState.dealerBet;
            amount = Math.min(amount, gameState.dealerChips - toCall);
            gameState.dealerChips -= (toCall + amount);
            gameState.dealerBet = gameState.currentBet + amount;
            gameState.currentBet = gameState.dealerBet;
            gameState.pot += (toCall + amount);
            addLog(`Dealer raises ${(toCall + amount)} (includes call)`, 'info');
            if (gameState.dealerChips === 0) { gameState.dealerAllIn = true; addLog('Dealer is ALL-IN!', 'warning'); }
        }
        function dealerAllIn() {
            const amount = gameState.dealerChips;
            gameState.dealerChips = 0;
            gameState.dealerBet += amount;
            if (gameState.dealerBet > gameState.currentBet) gameState.currentBet = gameState.dealerBet;
            gameState.pot += amount;
            gameState.dealerAllIn = true;
            addLog(`Dealer goes ALL IN for ${amount}!`, 'warning');
        }

        function intelligentDealerAction() {
            if (gameState.gamePhase === 'showdown') return; // no action after fold
            const handEval = evaluateHand([...gameState.dealerHoleCards, ...gameState.communityCards]);
            const toCall = gameState.currentBet - gameState.dealerBet;
            const strength = handEval.rank / 14; // 0..1
            let action;
            // Simple heuristic based on difficulty
            if (gameState.dealerChips === 0) { action = 'check'; }
            else if (gameState.playerAllIn && !gameState.dealerAllIn) {
                // Decide to call/fold your all-in based on strength threshold per difficulty
                const threshold = {easy:0.75, medium:0.55, hard:0.45, expert:0.40}[gameState.difficulty];
                if (strength >= threshold) action = toCall > 0 ? 'call' : 'check';
                else action = 'fold';
            } else if (toCall > 0) {
                // Facing a bet/raise
                if (strength > 0.8) action = 'raise';
                else if (strength > 0.4) action = 'call';
                else action = Math.random() < 0.2 ? 'call' : 'fold';
            } else {
                // No bet yet
                if (strength > 0.85) action = 'allIn';
                else if (strength > 0.7) action = 'bet';
                else action = 'check';
            }
            addLog('--- DEALER DECISION ---', 'info');
            addLog(`Dealer evaluates strength ${(strength*100).toFixed(0)}%`, 'info');
            addLog(`Dealer chooses: ${action.toUpperCase()}`, 'info');
            switch(action) {
                case 'fold': dealerFold(); break;
                case 'check': dealerCheck(); break;
                case 'call': dealerCall(); break;
                case 'bet': dealerBet(Math.min(100, gameState.dealerChips)); break;
                case 'raise': dealerRaise(Math.min(100, gameState.dealerChips - toCall)); break;
                case 'allIn': dealerAllIn(); break;
            }
        }

        /********************
         * DEALING & ROUND PROGRESSION
         ********************/
        function postBlinds() {
            // Alternate blinds by hand number (player small blind on odd hands)
            const playerSmall = gameState.handNumber % 2 === 1;
            const smallBlind = 10;
            const bigBlind = 20;
            if (playerSmall) {
                gameState.playerChips -= smallBlind; gameState.playerBet = smallBlind; gameState.pot += smallBlind;
                gameState.dealerChips -= bigBlind; gameState.dealerBet = bigBlind; gameState.pot += bigBlind; gameState.currentBet = bigBlind;
                addLog(`Blinds: You (${smallBlind}), Dealer (${bigBlind})`, 'info');
            } else {
                gameState.dealerChips -= smallBlind; gameState.dealerBet = smallBlind; gameState.pot += smallBlind;
                gameState.playerChips -= bigBlind; gameState.playerBet = bigBlind; gameState.pot += bigBlind; gameState.currentBet = bigBlind;
                addLog(`Blinds: Dealer (${smallBlind}), You (${bigBlind})`, 'info');
            }
        }
        function dealFlop() { gameState.communityCards.push(dealCard(), dealCard(), dealCard()); gameState.gamePhase = 'flop'; addLog('FLOP dealt', 'info'); }
        function dealTurn() { gameState.communityCards.push(dealCard()); gameState.gamePhase = 'turn'; addLog('TURN dealt', 'info'); }
        function dealRiver() { gameState.communityCards.push(dealCard()); gameState.gamePhase = 'river'; addLog('RIVER dealt', 'info'); }
        // Guided Mode helpers
        const guidedMessages = {
            'pre-flop': 'Pre-Flop: Evaluate your hole cards before acting.',
            'flop': 'Flop: Combine the 3 community cards with yours and reassess.',
            'turn': 'Turn: Fourth card‚Äîconsider pot size and drawing odds.',
            'river': 'River: Final card‚Äîno more cards before showdown.',
            'showdown': 'Showdown: Hands are compared; highest ranking wins.'
        };
        function clearHighlights(){ document.querySelectorAll('.highlight').forEach(el=>el.classList.remove('highlight')); }
        function updateGuidedState(){
            const prompt = document.getElementById('guidedPrompt');
            if(!gameState.guidedMode){ prompt.textContent=''; clearHighlights(); return; }
            prompt.textContent = guidedMessages[gameState.gamePhase] || '';
            clearHighlights();
            const map = { 'pre-flop':'#btnBet', flop:'#btnCheck', turn:'#btnCall', river:'#btnFold', showdown:'#btnAllIn' };
            const sel = map[gameState.gamePhase];
            const el = sel ? document.querySelector(sel) : null;
            if(el) el.classList.add('highlight');
        }

        function showdown() {
            gameState.gamePhase = 'showdown';
            addLog('=== SHOWDOWN ===', 'success');
            const playerHand = evaluateHand([...gameState.playerHoleCards, ...gameState.communityCards]);
            const dealerHand = evaluateHand([...gameState.dealerHoleCards, ...gameState.communityCards]);
            addLog(`Your cards: ${gameState.playerHoleCards.map(c=>rankToString(c.rank)+getSuitSymbol(c.suit)).join(', ')}`, 'info');
            addLog(`Dealer cards: ${gameState.dealerHoleCards.map(c=>rankToString(c.rank)+getSuitSymbol(c.suit)).join(', ')}`, 'info');
            addLog(`Board: ${gameState.communityCards.map(c=>rankToString(c.rank)+getSuitSymbol(c.suit)).join(', ')}`, 'info');
            addLog(`You have: ${playerHand.description}`, 'info');
            addLog(`Dealer has: ${dealerHand.description}`, 'info');
        }

        function endHand(winner) {
            if (winner === 'tie') {
                const half = Math.floor(gameState.pot / 2);
                gameState.playerChips += half;
                gameState.dealerChips += gameState.pot - half;
                addLog('ü§ù TIE - Pot split', 'warning');
            } else if (winner === 'player') {
                gameState.playerChips += gameState.pot;
                addLog(`üéâ YOU WIN ${gameState.pot} chips!`, 'success');
            } else if (winner === 'dealer') {
                gameState.dealerChips += gameState.pot;
                addLog(`üíÄ Dealer wins ${gameState.pot} chips.`, 'error');
            }
            gameState.pot = 0;
            gameState.playerStats.handsPlayed++;
            updatePlayerModel();
        }

        function startNewHand() {
            gameState.handNumber++;
            gameState.deck = createDeck();
            gameState.playerHoleCards = [];
            gameState.dealerHoleCards = [];
            gameState.communityCards = [];
            gameState.pot = 0;
            gameState.currentBet = 0;
            gameState.playerBet = 0;
            gameState.dealerBet = 0;
            gameState.foldedPlayer = null;
            gameState.playerAllIn = false;
            gameState.dealerAllIn = false;
            gameState.gamePhase = 'pre-flop';
            addLog(`========== HAND #${gameState.handNumber} ==========`,'info');
            postBlinds();
            gameState.playerHoleCards = [dealCard(), dealCard()];
            gameState.dealerHoleCards = [dealCard(), dealCard()];
            addLog(`Your cards: ${gameState.playerHoleCards.map(c=>rankToString(c.rank)+getSuitSymbol(c.suit)).join(', ')}`,'info');
            addLog('Dealer cards: [hidden]','info');
            updateGuidedState();
        }

    // ================================
    // UI Update functions & INTERFACE
    // ================================
        function updateUI() {
            // Update chips
            document.getElementById('player-chips').textContent = gameState.playerChips;
            document.getElementById('dealer-chips').textContent = gameState.dealerChips;
            document.getElementById('pot-amount').textContent = '$' + gameState.pot;
            
            // Update phase
            document.getElementById('phase-label').textContent = 
                gameState.gamePhase.replace('-', ' ').toUpperCase();
            
            // Update player cards
            const playerCardsEl = document.getElementById('player-cards');
            playerCardsEl.innerHTML = gameState.playerHoleCards.map(card => 
                `<div class="card ${card.suit}">
                    <div class="card-rank">${rankToString(card.rank)}</div>
                    <div class="card-suit">${getSuitSymbol(card.suit)}</div>
                </div>`
            ).join('');
            
            // Update community cards
            const communityCardsEl = document.getElementById('community-cards');
            communityCardsEl.innerHTML = gameState.communityCards.map(card =>
                `<div class="card ${card.suit}">
                    <div class="card-rank">${rankToString(card.rank)}</div>
                    <div class="card-suit">${getSuitSymbol(card.suit)}</div>
                </div>`
            ).join('');
            
            // Update stats
            document.getElementById('hands-played').textContent = gameState.playerStats.handsPlayed;
            document.getElementById('total-bets').textContent = gameState.playerStats.totalBets;
            document.getElementById('total-raises').textContent = gameState.playerStats.totalRaises;
            document.getElementById('total-calls').textContent = gameState.playerStats.totalCalls;
            document.getElementById('total-folds').textContent = gameState.playerStats.totalFolds;
            
            // Update AI analysis
            document.getElementById('player-type').textContent = gameState.playerModel.type;
            const confidence = Math.round(gameState.playerModel.confidence * 100);
            document.getElementById('confidence-bar').style.width = confidence + '%';
            document.getElementById('confidence-bar').textContent = confidence + '%';
            
            updateAIStrategy();
        }
        
        function disableActionButtons() {
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                btn.style.opacity = '0.5';
                btn.style.cursor = 'not-allowed';
            });
        }
        
        function enableActionButtons() {
            const buttons = document.querySelectorAll('.action-btn');
            buttons.forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
            });
        }
        
        function updateAIStrategy() {
            const type = gameState.playerModel.type;
            const strategies = {
                'aggressive-loose': 'AI is calling you down and trapping with strong hands',
                'aggressive-tight': 'AI is respecting your bets and playing cautiously',
                'passive-loose': 'AI is value betting more and avoiding bluffs',
                'passive-tight': 'AI is bluffing more frequently',
                'balanced': 'AI hasn\'t detected a clear pattern yet',
                'unknown': 'Play a few hands for AI to learn your style...'
            };
            document.getElementById('ai-strategy').textContent = strategies[type] || strategies['unknown'];
        }
        
        function addLog(message, type = 'info') {
            const logEl = document.getElementById('game-log');
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            logEl.insertBefore(entry, logEl.firstChild);
            
            // Limit to 50 entries
            while (logEl.children.length > 50) {
                logEl.removeChild(logEl.lastChild);
            }
        }
        
        function changeDifficulty(level) {
            setDifficulty(level);
            document.querySelectorAll('.difficulty-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`.difficulty-btn.${level}`).classList.add('active');
            addLog(`Difficulty set to: ${level.toUpperCase()}`, 'success');
        }
        
        function playerAction(action) {
            if (gameState.gamePhase === 'showdown') {
                addLog('Hand is over. Click "New Game" to continue.', 'warning');
                return;
            }
            
            if (gameState.gamePhase === 'waiting') {
                addLog('Click "New Game" to start a hand first!', 'warning');
                return;
            }
            
            // Validate action
            const toCall = gameState.currentBet - gameState.playerBet;
            
            if (action === 'check' && toCall > 0) {
                addLog('Cannot check - you must call, raise, or fold', 'warning');
                return;
            }
            
            if (action === 'call' && toCall === 0) {
                addLog('Nothing to call - use check instead', 'warning');
                return;
            }
            
            addLog(`You: ${action.toUpperCase()}`, 'info');
            
            if (action === 'fold') playerFold();
            else if (action === 'check') playerCheck();
            else if (action === 'call') playerCall();
            else if (action === 'bet') {
                if (gameState.currentBet > 0) {
                    addLog('Cannot bet - use raise instead', 'warning');
                    return;
                }
                const amount = Math.min(100, gameState.playerChips);
                playerBet(amount);
            }
            else if (action === 'raise') {
                if (toCall === 0) {
                    addLog('Nothing to raise - use bet instead', 'warning');
                    return;
                }
                const amount = Math.min(100, gameState.playerChips - toCall);
                playerRaise(amount);
            }
            else if (action === 'allin') {
                playerAllIn();
                gameState.playerAllIn = true; // Set flag for all-in
                addLog(`You go ALL IN for ${gameState.playerBet}!`, 'success');
            }
            
            updateUI();
            
            // Check if player folded
            if (gameState.gamePhase === 'showdown') {
                setTimeout(() => {
                    handleEndOfHand();
                }, 500);
                return;
            }
            
            // Check if player went all-in
            if (gameState.playerAllIn) {
                // Disable action buttons during all-in
                disableActionButtons();
                addLog('üî• ALL-IN! Dealer\'s action...', 'info');
                
                // Dealer's turn after short delay
                setTimeout(() => {
                    intelligentDealerAction();
                    updateUI();
                    
                    // Log dealer's action
                    if (gameState.foldedPlayer === 'dealer') {
                        addLog('Dealer folds! You win the pot.', 'success');
                    } else if (gameState.dealerAllIn) {
                        addLog(`Dealer goes ALL IN for ${gameState.dealerBet}!`, 'warning');
                    } else {
                        addLog(`Dealer calls ${gameState.dealerBet}`, 'info');
                    }
                    
                    // Check if dealer folded
                    if (gameState.gamePhase === 'showdown') {
                        setTimeout(() => {
                            handleEndOfHand();
                        }, 500);
                        return;
                    }
                    
                    // Dealer called all-in - deal remaining cards and go to showdown
                    setTimeout(() => {
                        dealAllRemainingCards();
                    }, 1000);
                }, 500);
                return;
            }
            
            // Dealer's turn after short delay
            setTimeout(() => {
                intelligentDealerAction();
                updateUI();
                
                // Check if dealer folded
                if (gameState.gamePhase === 'showdown') {
                    setTimeout(() => {
                        handleEndOfHand();
                    }, 500);
                    return;
                }
                
                // Check if dealer went all-in
                if (gameState.dealerAllIn) {
                    addLog('Dealer went all-in! Dealing remaining cards...', 'warning');
                    setTimeout(() => {
                        dealAllRemainingCards();
                    }, 1000);
                    return;
                }
                
                // Progress to next betting round
                setTimeout(() => {
                    progressGame();
                }, 1000);
            }, 500);
        }
        
        function progressGame() {
            // Check if betting round is complete (both players have acted and bets are equal)
            if (gameState.playerBet === gameState.dealerBet) {
                if (gameState.gamePhase === 'pre-flop') {
                    dealFlop();
                    updateUI();
                    updateGuidedState();
                } else if (gameState.gamePhase === 'flop') {
                    dealTurn();
                    updateUI();
                    updateGuidedState();
                } else if (gameState.gamePhase === 'turn') {
                    dealRiver();
                    updateUI();
                    updateGuidedState();
                } else if (gameState.gamePhase === 'river') {
                    // Go to showdown
                    showdown();
                    updateGuidedState();
                    setTimeout(() => {
                        handleEndOfHand();
                    }, 1000);
                }
            }
        }
        
        function dealAllRemainingCards() {
            addLog('üî• Dealing remaining cards...', 'success');
            
            // Deal all remaining cards based on current phase
            if (gameState.gamePhase === 'pre-flop') {
                setTimeout(() => {
                    dealFlop();
                    addLog('--- FLOP ---', 'info');
                    updateUI();
                    
                    setTimeout(() => {
                        dealTurn();
                        addLog('--- TURN ---', 'info');
                        updateUI();
                        updateGuidedState();
                        
                        setTimeout(() => {
                            dealRiver();
                            addLog('--- RIVER ---', 'info');
                            updateUI();
                            updateGuidedState();
                            
                            setTimeout(() => {
                                addLog('=== SHOWDOWN ===', 'success');
                                showdown();
                                updateGuidedState();
                                setTimeout(() => {
                                    handleEndOfHand();
                                    enableActionButtons(); // Re-enable buttons after hand ends
                                }, 1000);
                            }, 1500);
                        }, 1500);
                    }, 1500);
                }, 1500);
            } else if (gameState.gamePhase === 'flop') {
                setTimeout(() => {
                    dealTurn();
                    addLog('--- TURN ---', 'info');
                    updateUI();
                    updateGuidedState();
                    
                    setTimeout(() => {
                        dealRiver();
                        addLog('--- RIVER ---', 'info');
                        updateUI();
                        updateGuidedState();
                        
                        setTimeout(() => {
                            addLog('=== SHOWDOWN ===', 'success');
                            showdown();
                            updateGuidedState();
                            setTimeout(() => {
                                handleEndOfHand();
                                enableActionButtons(); // Re-enable buttons after hand ends
                            }, 1000);
                        }, 1500);
                    }, 1500);
                }, 1500);
            } else if (gameState.gamePhase === 'turn') {
                setTimeout(() => {
                    dealRiver();
                    addLog('--- RIVER ---', 'info');
                    updateUI();
                    updateGuidedState();
                    
                    setTimeout(() => {
                        addLog('=== SHOWDOWN ===', 'success');
                        showdown();
                        updateGuidedState();
                        setTimeout(() => {
                            handleEndOfHand();
                            enableActionButtons(); // Re-enable buttons after hand ends
                        }, 1000);
                    }, 1500);
                }, 1500);
            } else if (gameState.gamePhase === 'river') {
                setTimeout(() => {
                    addLog('=== SHOWDOWN ===', 'success');
                    showdown();
                    updateGuidedState();
                    setTimeout(() => {
                        handleEndOfHand();
                        enableActionButtons(); // Re-enable buttons after hand ends
                    }, 1000);
                }, 1000);
            }
        }
        
        function handleEndOfHand() {
            let winner;
            
            if (gameState.foldedPlayer === 'player') {
                winner = 'dealer';
            } else if (gameState.foldedPlayer === 'dealer') {
                winner = 'player';
            } else {
                // Determine winner by hand strength (showdown already called)
                const playerHand = evaluateHand([...gameState.playerHoleCards, ...gameState.communityCards]);
                const dealerHand = evaluateHand([...gameState.dealerHoleCards, ...gameState.communityCards]);
                
                if (playerHand.rank > dealerHand.rank) {
                    winner = 'player';
                } else if (dealerHand.rank > playerHand.rank) {
                    winner = 'dealer';
                } else {
                    if (playerHand.highCard > dealerHand.highCard) {
                        winner = 'player';
                    } else if (dealerHand.highCard > playerHand.highCard) {
                        winner = 'dealer';
                    } else {
                        winner = 'tie';
                    }
                }
            }
            
            // Award pot
            endHand(winner);
            updateUI();
            
            // Check for game over
            if (gameState.playerChips <= 0) {
                addLog('üíî GAME OVER - You are out of chips!', 'error');
                alert('Game Over! You ran out of chips.');
                return;
            }
            if (gameState.dealerChips <= 0) {
                addLog('üèÜ YOU WIN THE GAME - Dealer is out of chips!', 'success');
                alert('Congratulations! You beat the dealer!');
                return;
            }
            
            // Reset all-in flags for next hand
            gameState.playerAllIn = false;
            gameState.dealerAllIn = false;
            clearHighlights();
            
            // Auto-start next hand after 2 seconds
            addLog('Next hand starting in 2 seconds...', 'info');
            setTimeout(() => {
                startNewGame();
            }, 2000);
        }
        
        function startNewGame() {
            startNewHand();
            enableActionButtons(); // Make sure buttons are enabled for new hand
            addLog('=== NEW HAND STARTED ===', 'success');
            updateUI();
        }
        
        // Initialize and start first game
        changeDifficulty('medium');
        addLog('üé∞ Welcome to Poker vs AI! Starting first hand...', 'info');
        setTimeout(() => {
            startNewGame();
        }, 1500);
        updateUI();
        // Wire guided mode toggle
        document.getElementById('guided-toggle').addEventListener('change', (e)=>{
            gameState.guidedMode = e.target.checked;
            updateGuidedState();
        });
    </script>
</body>
</html>
