<!DOCTYPE html>
<html>
<head>
    <title>JavaScript Debugging Toolkit - Complete</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
            margin: 0;
        }
        
        h1, h2 {
            color: #4ec9b0;
        }
        
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            font-family: 'Courier New';
            border-radius: 4px;
            transition: all 0.2s;
        }
        
        button:hover {
            background: #1177bb;
            transform: translateY(-1px);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        .console {
            background: #1e1e1e;
            border: 2px solid #3c3c3c;
            padding: 15px;
            margin: 15px 0;
            max-height: 500px;
            overflow-y: auto;
            font-size: 14px;
            border-radius: 5px;
        }
        
        .log-entry {
            margin: 5px 0;
            padding: 8px;
            border-left: 3px solid #4ec9b0;
            background: rgba(255, 255, 255, 0.05);
        }
        
        .log-error {
            border-left-color: #f48771;
            color: #f48771;
            background: rgba(244, 135, 113, 0.1);
        }
        
        .log-warning {
            border-left-color: #dcdcaa;
            color: #dcdcaa;
            background: rgba(220, 220, 170, 0.1);
        }
        
        .log-info {
            border-left-color: #569cd6;
            color: #569cd6;
            background: rgba(86, 156, 214, 0.1);
        }
        
        .timestamp {
            color: #858585;
            font-size: 12px;
        }
        
        .variable-name {
            color: #9cdcfe;
            font-weight: bold;
        }
        
        .data-type {
            color: #4ec9b0;
            font-style: italic;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 10px 0;
        }
        
        th, td {
            border: 1px solid #3c3c3c;
            padding: 10px;
            text-align: left;
        }
        
        th {
            background: #2d2d30;
            color: #4ec9b0;
            font-weight: bold;
        }
        
        tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .tip {
            background: #1e3a5f;
            border-left: 4px solid #569cd6;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        
        .success {
            border-left-color: #4ec9b0;
            background: rgba(78, 201, 176, 0.1);
        }
        
        code {
            background: #2d2d30;
            padding: 2px 6px;
            border-radius: 3px;
            color: #ce9178;
        }
        
        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>üõ†Ô∏è JavaScript Debugging Toolkit</h1>
    <p>A collection of professional debugging utilities to help you find and fix bugs faster!</p>
    
    <div id="output" class="console"></div>
    
    <h2>Tool Tests</h2>
    
    <div class="button-group">
        <button onclick="testDebugLog()">üîç Test Debug Logger</button>
        <button onclick="testWatcher()">üëÅÔ∏è Test Variable Watcher</button>
        <button onclick="testTimer()">‚è±Ô∏è Test Function Timer</button>
        <button onclick="testErrorBoundary()">üõ°Ô∏è Test Error Boundary</button>
        <button onclick="testStateInspector()">üìä Test State Inspector</button>
        <button onclick="testAllTools()">üöÄ Test All Tools</button>
        <button onclick="clearOutput()" style="background: #dc3545;">üóëÔ∏è Clear Console</button>
    </div>

    <script>
        // ==============================================
        // OUTPUT HELPER
        // ==============================================
        function output(message, type = 'log') {
            let outputDiv = document.getElementById("output");
            let entry = document.createElement("div");
            entry.className = "log-entry log-" + type;
            entry.innerHTML = message;
            outputDiv.appendChild(entry);
            outputDiv.scrollTop = outputDiv.scrollHeight;
        }
        
        function clearOutput() {
            document.getElementById("output").innerHTML = "";
            output("<strong>Console cleared</strong>", "info");
        }
        
        // ==============================================
        // TOOL 1: ENHANCED CONSOLE LOGGER
        // ==============================================
        function debugLog(name, value) {
            // Get current time
            let now = new Date();
            let hours = now.getHours().toString().padStart(2, '0');
            let minutes = now.getMinutes().toString().padStart(2, '0');
            let seconds = now.getSeconds().toString().padStart(2, '0');
            let milliseconds = now.getMilliseconds().toString().padStart(3, '0');
            let timestamp = `${hours}:${minutes}:${seconds}.${milliseconds}`;
            
            // Get data type with better detection
            let type = getType(value);
            
            // Format value for display
            let displayValue = formatValue(value);
            
            // Get call location (using Error stack trace)
            let location = "";
            try {
                throw new Error();
            } catch (e) {
                let stack = e.stack.split('\n')[2]; // Get caller line
                if (stack) {
                    let match = stack.match(/at.*:(\d+):\d+/);
                    if (match) {
                        location = ` at line ${match[1]}`;
                    }
                }
            }
            
            // Output formatted log
            output(
                `<span class="timestamp">[${timestamp}]</span> ` +
                `<span class="variable-name">${name}</span> = ${displayValue} ` +
                `<span class="data-type">(${type})</span>${location}`
            );
        }
        
        // ==============================================
        // TOOL 2: VARIABLE WATCHER
        // ==============================================
        let watchers = {};
        let watchedValues = {};
        
        function watch(name) {
            if (watchers[name]) {
                output(`‚ö†Ô∏è Already watching: ${name}`, 'warning');
                return;
            }
            
            // Store original value
            let value = window[name];
            watchedValues[name] = value;
            
            // Log initial value
            output(`üëÅÔ∏è Now watching: <code>${name}</code> = ${formatValue(value)}`, 'info');
            
            // Create getter/setter to intercept changes
            Object.defineProperty(window, name, {
                get: function() {
                    return watchedValues[name];
                },
                set: function(newValue) {
                    let oldValue = watchedValues[name];
                    watchedValues[name] = newValue;
                    
                    // Log the change
                    output(
                        `üîÑ <span class="variable-name">${name}</span> changed: ` +
                        `${formatValue(oldValue)} ‚Üí ${formatValue(newValue)}`,
                        'info'
                    );
                },
                configurable: true // Allow unwatching
            });
            
            watchers[name] = true;
        }
        
        function unwatch(name) {
            if (!watchers[name]) {
                output(`‚ö†Ô∏è Not watching: ${name}`, 'warning');
                return;
            }
            
            // Restore original property
            delete window[name];
            window[name] = watchedValues[name];
            
            delete watchers[name];
            delete watchedValues[name];
            
            output(`üëÅÔ∏è Stopped watching: <code>${name}</code>`, 'info');
        }
        
        // ==============================================
        // TOOL 3: FUNCTION TIMER
        // ==============================================
        function timed(name, func, ...args) {
            // Get high-precision start time
            let start = performance.now();
            
            // Run function and capture result
            let result;
            try {
                result = func(...args);
            } catch (error) {
                let end = performance.now();
                let duration = (end - start).toFixed(3);
                output(`‚ùå <strong>${name}</strong> failed after ${duration}ms: ${error.message}`, 'error');
                throw error;
            }
            
            // Get end time and calculate duration
            let end = performance.now();
            let duration = (end - start).toFixed(3);
            
            // Color code based on duration
            let color = duration < 1 ? '#4ec9b0' : duration < 10 ? '#dcdcaa' : '#f48771';
            
            // Output result
            output(
                `‚è±Ô∏è <strong>${name}</strong> took <span style="color: ${color}">${duration}ms</span>`,
                'info'
            );
            
            return result;
        }
        
        // ==============================================
        // TOOL 4: ERROR BOUNDARY
        // ==============================================
        let errorTips = {
            "undefined": "üí° Check if variable is defined before using it",
            "null": "üí° Check if object exists before accessing properties",
            "not a function": "üí° Make sure you're calling a function, not a variable",
            "Cannot read": "üí° Object might be null or undefined - use optional chaining (?.)",
            "is not defined": "üí° Check variable name spelling and scope",
            "Cannot set": "üí° Property might be read-only or object is frozen",
            "Unexpected": "üí° Check for syntax errors like missing commas or brackets",
            "Invalid": "üí° Check that your data format is correct"
        };
        
        function safeCall(func, ...args) {
            try {
                let result = func(...args);
                output(`‚úÖ Function executed successfully`, 'info');
                return result;
            } catch (error) {
                // Show error with stack trace
                output(`‚ùå <strong>Error:</strong> ${error.message}`, 'error');
                
                // Show helpful tip
                let tip = getErrorTip(error.message);
                if (tip) {
                    output(`<div class="tip">${tip}</div>`);
                }
                
                // Show stack trace (first few lines)
                if (error.stack) {
                    let stackLines = error.stack.split('\n').slice(0, 3).join('<br>');
                    output(`<div style="font-size: 12px; color: #858585;">${stackLines}</div>`);
                }
                
                return null;
            }
        }
        
        function getErrorTip(errorMessage) {
            for (let key in errorTips) {
                if (errorMessage.includes(key)) {
                    return errorTips[key];
                }
            }
            return "üí° Check the error message and stack trace for clues";
        }
        
        // ==============================================
        // TOOL 5: STATE INSPECTOR
        // ==============================================
        function inspectState(filter = 'test') {
            output("<strong>üìä Current State:</strong>", "info");
            
            // Create table HTML
            let html = '<table><tr><th>Variable</th><th>Type</th><th>Value</th><th>Size</th></tr>';
            
            let count = 0;
            // Get relevant global variables
            for (let key in window) {
                // Filter to only show test variables or specified prefix
                if (key.startsWith(filter) || ['score', 'name', 'items', 'active', 'user'].includes(key)) {
                    let value = window[key];
                    let type = getType(value);
                    let displayValue = formatValue(value);
                    let size = getSize(value);
                    
                    html += `<tr>
                        <td><span class="variable-name">${key}</span></td>
                        <td><span class="data-type">${type}</span></td>
                        <td>${displayValue}</td>
                        <td>${size}</td>
                    </tr>`;
                    count++;
                }
            }
            
            html += '</table>';
            
            if (count === 0) {
                output(`No variables found with prefix "${filter}"`, 'warning');
            } else {
                output(html);
                output(`Found ${count} variable(s)`, 'info');
            }
        }
        
        // ==============================================
        // HELPER FUNCTIONS
        // ==============================================
        function getType(value) {
            if (value === null) return 'null';
            if (value === undefined) return 'undefined';
            if (Array.isArray(value)) return 'array';
            if (value instanceof Date) return 'date';
            if (value instanceof RegExp) return 'regexp';
            if (value instanceof Error) return 'error';
            if (typeof value === 'object') {
                return value.constructor ? value.constructor.name.toLowerCase() : 'object';
            }
            return typeof value;
        }
        
        function formatValue(value, maxLength = 100) {
            let type = getType(value);
            
            if (value === null) return '<span style="color: #569cd6">null</span>';
            if (value === undefined) return '<span style="color: #569cd6">undefined</span>';
            
            if (type === 'string') {
                let str = value.length > maxLength ? value.substring(0, maxLength) + '...' : value;
                return `<span style="color: #ce9178">"${escapeHtml(str)}"</span>`;
            }
            
            if (type === 'number') {
                return `<span style="color: #b5cea8">${value}</span>`;
            }
            
            if (type === 'boolean') {
                return `<span style="color: #569cd6">${value}</span>`;
            }
            
            if (type === 'array') {
                if (value.length === 0) return '[]';
                if (value.length > 3) {
                    return `[${value.slice(0, 3).map(v => formatValue(v, 20)).join(', ')}, ... +${value.length - 3} more]`;
                }
                return `[${value.map(v => formatValue(v, 20)).join(', ')}]`;
            }
            
            if (type === 'object' || type === 'date' || type === 'regexp') {
                try {
                    let str = JSON.stringify(value);
                    return str.length > maxLength ? str.substring(0, maxLength) + '...' : str;
                } catch (e) {
                    return '{...}';
                }
            }
            
            if (type === 'function') {
                let name = value.name || 'anonymous';
                return `<span style="color: #dcdcaa">∆í ${name}()</span>`;
            }
            
            return String(value);
        }
        
        function getSize(value) {
            let type = getType(value);
            
            if (type === 'string') return `${value.length} chars`;
            if (type === 'array') return `${value.length} items`;
            if (type === 'object') return `${Object.keys(value).length} keys`;
            
            // Approximate memory size
            let bytes = 0;
            if (type === 'number') bytes = 8;
            else if (type === 'boolean') bytes = 4;
            else if (type === 'string') bytes = value.length * 2;
            else if (type === 'object' || type === 'array') {
                bytes = JSON.stringify(value).length;
            }
            
            if (bytes < 1024) return `${bytes}B`;
            if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)}KB`;
            return `${(bytes / 1024 / 1024).toFixed(1)}MB`;
        }
        
        function escapeHtml(text) {
            let div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ==============================================
        // TEST FUNCTIONS
        // ==============================================
        function testDebugLog() {
            output("<strong>üîç Testing Enhanced Debug Logger:</strong>", "info");
            
            let score = 42;
            let name = "Alice";
            let items = ["sword", "shield", "potion"];
            let config = { level: 5, health: 100 };
            let isActive = true;
            
            debugLog("score", score);
            debugLog("name", name);
            debugLog("items", items);
            debugLog("config", config);
            debugLog("isActive", isActive);
            
            output("‚úì Debug logger test complete", "info");
        }
        
        function testWatcher() {
            output("<strong>üëÅÔ∏è Testing Variable Watcher:</strong>", "info");
            
            // Create a test variable
            window.testScore = 0;
            
            // Start watching
            watch("testScore");
            
            // Make changes
            setTimeout(() => { testScore = 10; }, 500);
            setTimeout(() => { testScore = 25; }, 1000);
            setTimeout(() => { testScore = 50; }, 1500);
            setTimeout(() => {
                unwatch("testScore");
                testScore = 100; // This won't be logged
                output("‚úì Variable watcher test complete", "info");
            }, 2000);
        }
        
        function testTimer() {
            output("<strong>‚è±Ô∏è Testing Function Timer:</strong>", "info");
            
            // Test fast function
            timed("fastLoop", function() {
                let sum = 0;
                for (let i = 0; i < 1000; i++) {
                    sum += i;
                }
                return sum;
            });
            
            // Test medium function
            timed("mediumLoop", function() {
                let sum = 0;
                for (let i = 0; i < 100000; i++) {
                    sum += i;
                }
                return sum;
            });
            
            // Test slow function
            timed("slowLoop", function() {
                let sum = 0;
                for (let i = 0; i < 5000000; i++) {
                    sum += i;
                }
                return sum;
            });
            
            output("‚úì Function timer test complete", "info");
        }
        
        function testErrorBoundary() {
            output("<strong>üõ°Ô∏è Testing Error Boundary:</strong>", "info");
            
            // Test 1: Undefined variable
            safeCall(function() {
                console.log(nonExistentVariable);
            });
            
            // Test 2: Calling non-function
            safeCall(function() {
                let notAFunction = 42;
                notAFunction();
            });
            
            // Test 3: Null property access
            safeCall(function() {
                let obj = null;
                console.log(obj.property);
            });
            
            // Test 4: Array index error
            safeCall(function() {
                let arr = [1, 2, 3];
                return arr[10].toString();
            });
            
            // Test 5: Working function
            safeCall(function() {
                output("<div class='tip success'>‚úÖ This function works perfectly!</div>");
                return "Success!";
            });
            
            output("‚úì Error boundary test complete", "info");
        }
        
        function testStateInspector() {
            output("<strong>üìä Testing State Inspector:</strong>", "info");
            
            // Create test variables
            window.testScore = 100;
            window.testName = "Bob";
            window.testActive = true;
            window.testItems = ["potion", "key", "map"];
            window.testConfig = { difficulty: "hard", volume: 80 };
            
            inspectState('test');
            
            output("‚úì State inspector test complete", "info");
        }
        
        function testAllTools() {
            clearOutput();
            output("<h2>üöÄ Running All Tool Tests</h2>", "info");
            
            testDebugLog();
            output("<hr style='border-color: #3c3c3c; margin: 20px 0;'>");
            
            testTimer();
            output("<hr style='border-color: #3c3c3c; margin: 20px 0;'>");
            
            testErrorBoundary();
            output("<hr style='border-color: #3c3c3c; margin: 20px 0;'>");
            
            testStateInspector();
            output("<hr style='border-color: #3c3c3c; margin: 20px 0;'>");
            
            testWatcher();
            
            output("<h2>‚úÖ All Tests Complete!</h2>", "info");
        }
        
        // Welcome message
        output("<h2>Welcome to the Debugging Toolkit!</h2>", "info");
        output("Click the buttons above to test each tool. Each tool helps you debug JavaScript code more effectively.", "info");
        output("<div class='tip'>üí° <strong>Pro Tip:</strong> These tools are similar to what professional developers use every day. Chrome DevTools, console.log alternatives like 'debug' npm package, and error monitoring services like Sentry all work on similar principles!</div>");
    </script>
</body>
</html>