<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Example 3: Split Pots - Showdown & Winner</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1100px;
            margin: 50px auto;
            padding: 20px;
            background-color: #2c5530;
            color: white;
        }
        .container {
            background: white;
            color: #333;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
        }
        h1 { color: #2c5530; margin-top: 0; }
        h2 { color: #4CAF50; margin-top: 30px; }
        .info-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
        }
        .card-display {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .card {
            background: white;
            border: 3px solid #333;
            border-radius: 8px;
            padding: 12px 16px;
            font-size: 28px;
            font-weight: bold;
            min-width: 70px;
            text-align: center;
            box-shadow: 0 3px 6px rgba(0,0,0,0.3);
            transition: all 0.3s;
        }
        .card:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 10px rgba(0,0,0,0.4);
        }
        .card.hearts, .card.diamonds { color: #d32f2f; }
        .card.clubs, .card.spades { color: #000; }
        .player-result {
            background: #f5f5f5;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            border: 3px solid #ddd;
            transition: all 0.3s;
        }
        .player-result.winner {
            border-color: #FFD700;
            background: #fffef5;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.5);
            animation: winnerGlow 2s infinite;
        }
        @keyframes winnerGlow {
            0%, 100% { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }
        .player-name {
            font-size: 22px;
            font-weight: bold;
            color: #2c5530;
            margin-bottom: 10px;
        }
        .player-chips {
            font-size: 16px;
            color: #666;
            margin: 5px 0;
        }
        .player-hand-rank {
            background: #e8f5e9;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
            color: #2c5530;
            border-left: 4px solid #4CAF50;
        }
        .win-amount {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 20px;
            font-weight: bold;
            text-align: center;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        .pot-distribution {
            background: linear-gradient(135deg, #4CAF50, #2e7d32);
            color: white;
            padding: 25px;
            border-radius: 10px;
            margin: 30px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        .pot-distribution h3 {
            margin-top: 0;
            font-size: 24px;
            border-bottom: 2px solid rgba(255,255,255,0.3);
            padding-bottom: 10px;
        }
        .distribution-item {
            background: rgba(255,255,255,0.2);
            padding: 12px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 16px;
        }
        .calculation-box {
            background: #e3f2fd;
            border-left: 5px solid #2196F3;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .calculation-step {
            padding: 8px 0;
            font-family: monospace;
            border-bottom: 1px solid #ccc;
        }
        .calculation-step:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #2196F3;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 14px 28px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-weight: bold;
            transition: all 0.3s;
        }
        button:hover { 
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        button.secondary {
            background: #2196F3;
        }
        button.secondary:hover {
            background: #1976d2;
        }
        .output {
            margin-top: 20px;
            padding: 20px;
            background: #f5f5f5;
            border-radius: 5px;
            border-left: 4px solid #4CAF50;
            min-height: 100px;
        }
        .debug {
            font-family: monospace;
            background: #1e1e1e;
            color: #4ec9b0;
            padding: 15px;
            border-radius: 5px;
            margin-top: 10px;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Example 3: Split Pots</h1>
        
        <div class="info-box">
            <strong>üìö Learning Objective:</strong> This example demonstrates handling tied hands and splitting pots fairly among multiple winners. You'll learn how to divide pots evenly and handle odd chips (remainders) that can't be divided equally.
        </div>
        
        <h2>Test Scenarios</h2>
        <div style="text-align: center; margin: 20px 0;">
            <button onclick="testCase1()">üéÆ Test Case 1: 2-Way Tie (Even Split)</button>
            <button onclick="testCase2()" class="secondary">Test Case 2: 3-Way Tie</button>
            <button onclick="runExample()" class="secondary">Test Case 3: Odd Chip Handling</button>
        </div>
        
        <div id="output" class="output">
            <h3>Click a test case to see split pot scenarios...</h3>
            <p>Each scenario shows how pots are divided when multiple players tie, including handling remainders.</p>
        </div>
        
        <div id="debug" class="debug"></div>
    </div>

    <script>
        /*
         * SPLIT POT EXAMPLE
         * Demonstrates calculating and distributing pots when multiple players tie
         * Handles odd chips (indivisible amounts) according to poker rules
         * Shows detailed calculation steps
         */
        
        console.log('Example 3: Split Pots - Advanced Pot Distribution');
        console.log('Lesson: Showdown & Winner Determination');
        console.log('Version: 2.0 - Enhanced with detailed calculations');
        
        function getSuitSymbol(suit) {
            const symbols = { hearts: "‚ô•", diamonds: "‚ô¶", clubs: "‚ô£", spades: "‚ô†" };
            return symbols[suit] || suit;
        }

        function createCard(rank, suit, value) {
            return { rank, suit, value };
        }

        function createPlayer(name, chips, hand) {
            return { name, chips, hand, handRank: null, winAmount: 0, originalChips: chips };
        }

        // Comprehensive hand evaluation
        function evaluateHand(cards) {
            const sorted = [...cards].sort((a, b) => b.value - a.value);
            
            const groups = {};
            sorted.forEach(card => {
                if (!groups[card.value]) groups[card.value] = [];
                groups[card.value].push(card);
            });
            
            const counts = Object.values(groups).map(g => g.length).sort((a, b) => b - a);
            const values = Object.keys(groups).map(Number).sort((a, b) => b - a);
            
            console.log("  Evaluating: " + formatCards(cards));
            
            if (counts[0] === 4) {
                console.log("  ‚Üí Four of a Kind: " + getRankName(values[0]) + "s");
                return { 
                    rank: 7, 
                    name: "Four of a Kind",
                    primaryValue: values[0],
                    kickers: values.slice(1)
                };
            }
            if (counts[0] === 3 && counts[1] === 2) {
                console.log("  ‚Üí Full House: " + getRankName(values[0]) + "s over " + getRankName(values[1]) + "s");
                return { 
                    rank: 6, 
                    name: "Full House",
                    primaryValue: values[0],
                    secondaryValue: values[1]
                };
            }
            if (counts[0] === 3) {
                console.log("  ‚Üí Three of a Kind: " + getRankName(values[0]) + "s");
                return { 
                    rank: 3, 
                    name: "Three of a Kind",
                    primaryValue: values[0],
                    kickers: values.slice(1)
                };
            }
            if (counts[0] === 2 && counts[1] === 2) {
                console.log("  ‚Üí Two Pair: " + getRankName(values[0]) + "s and " + getRankName(values[1]) + "s");
                return { 
                    rank: 2, 
                    name: "Two Pair",
                    primaryValue: values[0],
                    secondaryValue: values[1],
                    kickers: values.slice(2)
                };
            }
            if (counts[0] === 2) {
                console.log("  ‚Üí Pair of " + getRankName(values[0]) + "s");
                return { 
                    rank: 1, 
                    name: "Pair",
                    primaryValue: values[0],
                    kickers: values.slice(1)
                };
            }
            
            console.log("  ‚Üí High Card: " + getRankName(values[0]));
            return { rank: 0, name: "High Card", kickers: values };
        }

        // Determine winners with detailed comparison
        function determineWinners(players) {
            console.log("\n" + "=".repeat(60));
            console.log("DETERMINING WINNER(S)");
            console.log("=".repeat(60));
            
            // Evaluate all hands
            players.forEach(player => {
                console.log("\n" + player.name + "'s hand:");
                player.handRank = evaluateHand(player.hand);
            });
            
            console.log("\n--- Comparison ---");
            
            // Find best rank
            let bestRank = Math.max(...players.map(p => p.handRank.rank));
            let candidates = players.filter(p => p.handRank.rank === bestRank);
            
            console.log("Best hand type: " + candidates[0].handRank.name + " (rank " + bestRank + ")");
            console.log("Candidates: " + candidates.map(p => p.name).join(", "));
            
            if (candidates.length === 1) {
                console.log("‚úì Single winner: " + candidates[0].name);
                return [candidates[0]];
            }
            
            // Compare tied hands more thoroughly
            const winners = compareForTies(candidates);
            
            if (winners.length > 1) {
                console.log("‚úì SPLIT POT between: " + winners.map(w => w.name).join(", "));
            } else {
                console.log("‚úì Winner after tie-breaker: " + winners[0].name);
            }
            
            return winners;
        }

        // Compare players with same rank to find actual winners
        function compareForTies(candidates) {
            if (candidates.length === 1) return candidates;
            
            // Compare primary value
            if (candidates[0].handRank.primaryValue !== undefined) {
                const maxPrimary = Math.max(...candidates.map(c => c.handRank.primaryValue));
                candidates = candidates.filter(c => c.handRank.primaryValue === maxPrimary);
                if (candidates.length === 1) return candidates;
            }
            
            // Compare secondary value
            if (candidates[0].handRank.secondaryValue !== undefined) {
                const maxSecondary = Math.max(...candidates.map(c => c.handRank.secondaryValue));
                candidates = candidates.filter(c => c.handRank.secondaryValue === maxSecondary);
                if (candidates.length === 1) return candidates;
            }
            
            // Compare kickers
            if (candidates[0].handRank.kickers && candidates[0].handRank.kickers.length > 0) {
                for (let i = 0; i < candidates[0].handRank.kickers.length; i++) {
                    const maxKicker = Math.max(...candidates.map(c => 
                        c.handRank.kickers[i] !== undefined ? c.handRank.kickers[i] : 0
                    ));
                    candidates = candidates.filter(c => 
                        (c.handRank.kickers[i] || 0) === maxKicker
                    );
                    if (candidates.length === 1) return candidates;
                }
            }
            
            // Still tied - all winners
            return candidates;
        }

        // Split pot with detailed calculations
        function splitPot(potAmount, winners) {
            console.log("\n" + "=".repeat(60));
            console.log("SPLITTING POT");
            console.log("=".repeat(60));
            console.log("Total Pot: $" + potAmount);
            console.log("Number of Winners: " + winners.length);
            
            const calculations = [];
            calculations.push("Total pot: $" + potAmount);
            calculations.push("Winners: " + winners.length + " (" + winners.map(w => w.name).join(", ") + ")");
            
            // Calculate base amount per winner
            const baseAmount = Math.floor(potAmount / winners.length);
            const oddChip = potAmount % winners.length;
            
            console.log("\nCalculations:");
            console.log("  Base amount = floor($" + potAmount + " / " + winners.length + ") = $" + baseAmount);
            calculations.push("Base amount = $" + potAmount + " √∑ " + winners.length + " = $" + baseAmount + " per player");
            
            if (oddChip > 0) {
                console.log("  Odd chip = $" + potAmount + " % " + winners.length + " = $" + oddChip);
                console.log("  Odd chip awarded to: " + winners[0].name + " (closest to button)");
                calculations.push("Remainder = $" + potAmount + " mod " + winners.length + " = $" + oddChip);
                calculations.push("Odd chip goes to " + winners[0].name + " (first position)");
            } else {
                console.log("  Perfect split - no odd chips!");
                calculations.push("Perfect split - no remainder!");
            }
            
            console.log("\nDistribution:");
            const distribution = [];
            
            winners.forEach((winner, index) => {
                // First winner gets the odd chip
                winner.winAmount = baseAmount + (index === 0 ? oddChip : 0);
                winner.chips = winner.originalChips + winner.winAmount;
                
                console.log("  " + winner.name + ": $" + winner.winAmount + 
                    (index === 0 && oddChip > 0 ? " (includes $" + oddChip + " odd chip)" : ""));
                
                distribution.push({
                    name: winner.name,
                    amount: winner.winAmount,
                    hasOddChip: index === 0 && oddChip > 0,
                    newTotal: winner.chips
                });
                
                calculations.push(winner.name + " receives: $" + winner.winAmount + 
                    (index === 0 && oddChip > 0 ? " ($" + baseAmount + " + $" + oddChip + " odd chip)" : ""));
            });
            
            console.log("=".repeat(60));
            
            return {
                baseAmount,
                oddChip,
                distribution,
                calculations
            };
        }

        function getRankName(value) {
            const names = { 14: 'A', 13: 'K', 12: 'Q', 11: 'J', 10: '10' };
            return names[value] || value.toString();
        }

        function formatCards(cards) {
            return cards.map(c => c.rank + getSuitSymbol(c.suit)).join(" ");
        } 
                    rank: 2, 
                    name: "Two Pair",
                    primaryValue: values[0],
                    secondaryValue: values[1],
                    kickers: values.slice(2)
                };
            }
            if (counts[0] === 2) {
                return { 
                    rank: 1, 
                    name: "Pair",
                    primaryValue: values[0],
                    kickers: values.slice(1)
                };
            }
            
            return { rank: 0, name: "High Card", kickers: values };
        }

        // Determine winners (can be multiple in case of tie)
        function determineWinners(players) {
            console.log("\n=== DETERMINING WINNER(S) ===");
            
            // Evaluate all hands
            players.forEach(player => {
                player.handRank = evaluateHand(player.hand);
                console.log(player.name + " has: " + player.handRank.name);
            });
            
            // Find best rank
            let bestRank = Math.max(...players.map(p => p.handRank.rank));
            let candidates = players.filter(p => p.handRank.rank === bestRank);
            
            console.log("\nBest hand rank: " + candidates[0].handRank.name);
            console.log("Candidates: " + candidates.map(p => p.name).join(", "));
            
            if (candidates.length === 1) {
                console.log("‚úì Single winner: " + candidates[0].name);
                return [candidates[0]];
            }
            
            // Compare among tied rank to find actual winners
            const winners = filterWinners(candidates);
            
            if (winners.length > 1) {
                console.log("‚úì SPLIT POT between: " + winners.map(w => w.name).join(", "));
            } else {
                console.log("‚úì Winner after kicker comparison: " + winners[0].name);
            }
            
            return winners;
        }

        function filterWinners(candidates) {
            if (candidates.length === 1) return candidates;
            
            // For simplicity, compare primary value, then secondary, then kickers
            const compareValue = (key) => {
                const maxVal = Math.max(...candidates.map(c => c.handRank[key] || 0));
                return candidates.filter(c => (c.handRank[key] || 0) === maxVal);
            };
            
            let filtered = compareValue('primaryValue');
            if (filtered.length === 1) return filtered;
            
            filtered = filtered.length > 0 ? compareValue('secondaryValue').filter(c => 
                filtered.includes(c)
            ) : filtered;
            
            if (filtered.length === 1 || filtered.length === 0) {
                return filtered.length > 0 ? filtered : candidates;
            }
            
            // Compare first kicker
            const kickers = filtered.map(c => c.handRank.kickers[0] || 0);
            const maxKicker = Math.max(...kickers);
            filtered = filtered.filter(c => (c.handRank.kickers[0] || 0) === maxKicker);
            
            return filtered;
        }

        // Split pot among winners
        function splitPot(potAmount, winners) {
            console.log("\n=== SPLITTING POT ===");
            console.log("Total Pot: $" + potAmount);
            console.log("Winners: " + winners.length);
            
            const baseAmount = Math.floor(potAmount / winners.length);
            const oddChip = potAmount % winners.length;
            
            console.log("Base amount per winner: $" + baseAmount);
            if (oddChip > 0) {
                console.log("Odd chip(s): $" + oddChip + " (goes to player closest to button)");
            }
            
            winners.forEach((winner, index) => {
                winner.winAmount = baseAmount + (index === 0 ? oddChip : 0);
                winner.chips += winner.winAmount;
                console.log("  " + winner.name + " receives: $" + winner.winAmount);
            });
            
            return {
                baseAmount,
                oddChip,
                distribution: winners.map(w => ({ name: w.name, amount: w.winAmount }))
            };
        }

        function displaySplitPot(players, pot, winners, distribution) {
            const output = document.getElementById("output");
            
            let html = '<h3>Split Pot Result</h3>';
            html += `<div style="margin: 15px 0; font-size: 18px; font-weight: bold;">Total Pot: $${pot}</div>`;
            
            // Show all players
            players.forEach(player => {
                const isWinner = winners.includes(player);
                html += `<div class="player-result ${isWinner ? 'winner' : ''}">`;
                html += `<div class="player-name">${player.name}</div>`;
                html += '<div class="card-display">';
                player.hand.forEach(card => {
                    html += `<div class="card ${card.suit}">${card.rank}${getSuitSymbol(card.suit)}</div>`;
                });
                html += '</div>';
                html += `<div style="margin-top: 10px; font-weight: bold; color: #4CAF50;">${player.handRank.name}</div>`;
                if (isWinner) {
                    html += `<div style="margin-top: 10px; font-size: 18px; color: #FFD700;">üèÜ WINS $${player.winAmount}</div>`;
                }
                html += '</div>';
            });
            
            // Distribution summary
            html += '<div class="pot-distribution">';
            html += '<h3 style="margin-top: 0;">Pot Distribution</h3>';
            html += `<div><strong>Winners:</strong> ${winners.length}</div>`;
            html += `<div><strong>Base Amount:</strong> $${distribution.baseAmount} each</div>`;
            if (distribution.oddChip > 0) {
                html += `<div><strong>Odd Chip:</strong> $${distribution.oddChip} to ${winners[0].name}</div>`;
            }
            distribution.distribution.forEach(d => {
                html += `<div style="margin-top: 5px;">‚Ä¢ ${d.name}: $${d.amount}</div>`;
            });
            html += '</div>';
            
            output.innerHTML = html;
        }

        // Test Cases
        function testCase1() {
            console.log('\n' + '='.repeat(60));
            console.log('TEST CASE 1: 2-Way Tie (Even Split)');
            console.log('='.repeat(60));
            
            const players = [
                createPlayer("Alice", 1000, [
                    createCard('K', 'hearts', 13),
                    createCard('K', 'diamonds', 13),
                    createCard('A', 'spades', 14),
                    createCard('Q', 'clubs', 12),
                    createCard('J', 'hearts', 11)
                ]),
                createPlayer("Bob", 1000, [
                    createCard('K', 'spades', 13),
                    createCard('K', 'clubs', 13),
                    createCard('A', 'hearts', 14),
                    createCard('Q', 'diamonds', 12),
                    createCard('J', 'spades', 11)
                ]),
                createPlayer("Charlie", 1000, [
                    createCard('J', 'diamonds', 11),
                    createCard('10', 'hearts', 10),
                    createCard('9', 'spades', 9),
                    createCard('8', 'clubs', 8),
                    createCard('7', 'hearts', 7)
                ])
            ];
            
            const pot = 300;
            const winners = determineWinners(players);
            const distribution = splitPot(pot, winners);
            displaySplitPot(players, pot, winners, distribution);
            
            console.log('\n‚úÖ Test complete: Pot split evenly between ' + winners.length + ' winners');
        }

        function testCase2() {
            console.log('\n' + '='.repeat(60));
            console.log('TEST CASE 2: 3-Way Tie (Even Split)');
            console.log('='.repeat(60));
            
            const players = [
                createPlayer("Alice", 1000, [
                    createCard('A', 'hearts', 14),
                    createCard('A', 'diamonds', 14),
                    createCard('K', 'spades', 13),
                    createCard('Q', 'clubs', 12),
                    createCard('J', 'hearts', 11)
                ]),
                createPlayer("Bob", 1000, [
                    createCard('A', 'spades', 14),
                    createCard('A', 'clubs', 14),
                    createCard('K', 'hearts', 13),
                    createCard('Q', 'diamonds', 12),
                    createCard('J', 'spades', 11)
                ]),
                createPlayer("Charlie", 1000, [
                    createCard('A', 'diamonds', 14),
                    createCard('A', 'hearts', 14),
                    createCard('K', 'clubs', 13),
                    createCard('Q', 'spades', 12),
                    createCard('J', 'diamonds', 11)
                ])
            ];
            
            const pot = 450;
            const winners = determineWinners(players);
            const distribution = splitPot(pot, winners);
            displaySplitPot(players, pot, winners, distribution);
            
            console.log('\n‚úÖ Test complete: 3-way split of $' + pot);
        }

        function runExample() {
            console.log('\n' + '='.repeat(60));
            console.log('TEST CASE 3: 2-Way Tie with Odd Chip');
            console.log('='.repeat(60));
            
            const players = [
                createPlayer("Alice", 1000, [
                    createCard('Q', 'hearts', 12),
                    createCard('Q', 'diamonds', 12),
                    createCard('J', 'spades', 11),
                    createCard('10', 'clubs', 10),
                    createCard('9', 'hearts', 9)
                ]),
                createPlayer("Bob", 1000, [
                    createCard('Q', 'spades', 12),
                    createCard('Q', 'clubs', 12),
                    createCard('J', 'hearts', 11),
                    createCard('10', 'diamonds', 10),
                    createCard('9', 'spades', 9)
                ]),
                createPlayer("Charlie", 1000, [
                    createCard('5', 'diamonds', 5),
                    createCard('5', 'hearts', 5),
                    createCard('3', 'spades', 3),
                    createCard('2', 'clubs', 2),
                    createCard('A', 'hearts', 14)
                ])
            ];
            
            const pot = 255; // Odd amount that doesn't divide evenly
            const winners = determineWinners(players);
            const distribution = splitPot(pot, winners);
            displaySplitPot(players, pot, winners, distribution);
            
            console.log('\n‚úÖ Test complete: Odd chip of $' + distribution.oddChip + ' awarded to ' + winners[0].name);
        }

        // Capture console output to debug div
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            const debugDiv = document.getElementById('debug');
            debugDiv.textContent += args.join(' ') + '\n';
        };
        
        // Initialize
        console.log('Example 3: Split Pots loaded and ready!');
        console.log('Click test cases to see pot splitting logic.');
    </script>
</body>
</html>
